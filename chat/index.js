const { Anthropic } = require('@anthropic-ai/sdk');

module.exports = async function (context, req) {
    context.log('Function starting...');
    
    // Handle CORS preflight
    if (req.method === 'OPTIONS') {
        context.res = {
            status: 204,
            headers: {
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "POST, OPTIONS",
                "Access-Control-Allow-Headers": "Content-Type",
                "Access-Control-Max-Age": "86400"
            }
        };
        return;
    }

    try {
        // Check if API key exists
        if (!process.env.ANTHROPIC_API_KEY) {
            throw new Error('API key not configured');
        }

        // Initialize Anthropic client
        const anthropic = new Anthropic({
            apiKey: process.env.ANTHROPIC_API_KEY,
        });

        const { message } = req.body;
        context.log('Received message:', message);
        
        if (!message) {
            context.res = {
                status: 400,
                headers: {
                    "Access-Control-Allow-Origin": "*",
                    "Access-Control-Allow-Methods": "POST, OPTIONS",
                    "Content-Type": "application/json"
                },
                body: { error: "No message provided" }
            };
            return;
        }

        // BFL Rules Context
        const rulesContext = `You are the official MLF BFL Rules Assistant. Your purpose is to provide accurate information ONLY about MLF Bass Fishing League (BFL) tournament rules and regulations.

IMPORTANT GUIDELINES:
1. ONLY answer questions related to MLF BFL rules and tournament regulations
2. If asked about anything not related to BFL rules, politely redirect to BFL rules topics
3. When answering, always reference specific sections of the rules
4. If a topic isn't covered in the rules, clearly state that
5. Do not provide general fishing advice or tips unless explicitly stated in the BFL rules
6. Be concise and direct in your responses
7. If questions are about controversial rules interpretations, state that the tournament director has final authority

Official MLF BFL Rules: [
majorleaguefishing.com
Phoenix Bass Fishing League - Major League Fishing
36–45 minutes
2025 Phoenix Bass Fishing League Rules

MLFLW, LLC, (DBA “MLF”) expects strict adherence to the following rules by all contestants. Additionally, MLF suggests that co-anglers share fuel expenses with their boater partner to help offset the high cost of boat operation. MLF recommends the use of livewell additives like T-H Marine G-Juice to help promote the healthy release of bass. MLF discourages sharing a partner’s phone number with anyone without the partner’s consent. MLF recommends the use of EPIRBs and Personal Locator Beacons. In the event of an emergency, please call 911 first and then notify the tournament director. The tournament director should be notified as soon as possible prior to weigh-in if you use a mobile communication device for any purpose other than GPS, mapping, weather, power generation, barge traffic updates, tidal charts, personal fishing notes and related data as outlined in rule 10. Except where noted, the following rules apply to Phoenix Bass Fishing League tournaments.

2025 Phoenix Bass Fishing League presented by T-H Marine Rules:

1. INTERPRETATION & ENFORCEMENT • These rules will remain unchanged during 2025. Interpretation and enforcement of these rules will be left exclusively to MLF. Decisions of the tournament director are final in all matters and are not subject to appeal. Each contestant agrees to report any rule violation to the tournament director immediately upon discovery of the violation. Failure to report violations (boater or co-angler) may be cause for disqualification. The violation of a tournament rule may result in, but is not limited to, weight loss, the loss of weight up to a particular time in the tournament day, the loss of weight for the entire day, the loss of the heaviest one-day catch, the loss of the heaviest bass for the day, disqualification from the entire tournament, a fine of not less than $25 nor more than $500 or ineligibility to participate in future MLF tournaments. Protests and/or alleged rule violations are to be documented in writing by the witness within 30 minutes of the check-in time of the final flight of each tournament day. MLF reserves the right to consider rule violations reported or discovered after a tournament has ended and assess penalties for future events, including denying entry to compete. 

2. PAYBACK & PARTICIPATION • Payback is based on the number of paid entries for each tournament. Participation is open only to members of MLF who are 16 years of age or older. Any person under the age of 18 (19 in Alabama and Nebraska) entering a tournament must also have the signature of a parent or legal guardian in the provided space on the entry form. Any person’s participation in any tournament is at the sole discretion of MLF officials. Any person who, in the judgment of the tournament director, is disabled or handicapped in such a manner as to unfairly hinder his or her boater or co-angler partner or compromise his or her safety or the safety of other competitors or the boating public may not be eligible to participate. All contestants must have a valid fishing license for the waters they fish. Random checks will be conducted at each tournament. Failure to provide proof of a valid fishing license within a reasonable amount of time when requested by the tournament director will result in disqualification for that day and any preceding days in which the license was required for the tournament. 

BOATER & CO-ANGLER ENTRY: Entries will be accepted by division beginning at 8 a.m. Central time on the following dates: December 2, 2024 – Bama, Choo Choo, Cowboy, Gator and Savannah River. December 3, 2024 –Arkie, Bulldog, North Carolina, South Carolina and Volunteer. December 4, 2024 – LBL, Mississippi, Okie, Ozark and Piedmont. December 5, 2024 – Great Lakes, Hoosier, Mountain, Music City and Shenandoah. December 6, 2024 – Buckeye, Illini, Michigan and Northeast. Phoenix boat owners (Phoenix owners with current registrations or confirmation of a boat order who will use their Phoenix boat in Bass Fishing League competition) and TBF members may enter all divisions by phone starting November 29, 2024. Boatersentering by the priority deadline for each tournament and providing co-anglers (with membership numbers who have not yet been confirmed in the tournament) will be given priority and a guaranteed co-angler draw. Co-anglers entering by the priority deadline for each tournament and providing boaters (with membership numbers who have not yet been confirmed in the tournament) will be given priority. Boater and co-angler priority and boater draw guarantees are granted when matching boater and co-angler entries (listing each other’s name and membership number) are received by the priority deadline and are contingent on both anglers competing in the tournament entered. Entering with a boater or co-angler does not guarantee you will be fishing together in the same boat. All boaters and co-anglers, regardless of priority, will be paired by random draw per rule 7. All other entry priority will be assigned by the date and time of entry. Boaters will not be confirmed unless there is a co-angler entered to be paired with, meaning the field is balanced and there are no boat-on-boat draws. Entries may be made by mail (30 Gamble Lane, Benton, KY 42025), phone (270.252.1000) or at MajorLeagueFishing.com. Do not make entry by more than one method. Published payouts for each qualifier and super tournament are based on 200 boater and 200 co-angler entries. Published payouts for Regionals are based on 130 boater and 130 co-angler entries. Late entries will be accepted through check-in the day before a tournament when a field is not yet balanced or at 200 boaters and 200 co-anglers and are subject to a $25 service charge. Entries that are unable to be confirmed due to an unbalanced field and entries received after a tournament has reached 200 boaters and 200 co-anglers will be placed on a waiting list. Those anglers placed on the waiting list and not accepted into the tournament will receive a full refund after the tournament and will maintain Wild Card eligibility. CONFIRMED ENTRIES ARE CONTINGENT UPON COMPLETE ENTRY FEE BEING PAID BY THE ENTRY DEADLINE DATE. Entry fees may be transferred or refunded if MLF is notified by 5 p.m. Central time the Tuesday prior to a tournament. ENTRY FEES WILL NOT BE TRANSFERRED OR REFUNDED AFTER TUESDAY. Each refunded entry fee is subject to a $10 service charge. MLF may accept more than 200 boaters and 200 co-anglers into a tournament based on market demand, not to exceed 230 boaters and 230 co-anglers in qualifying tournaments and 220 boaters and 220 co-anglers in super tournaments. MLF may, at its sole discretion, accept entries after the entry deadline date to balance a field.   

WILD CARD ELIGIBILITY: Contestants who pay a Boater entry fee prior to the tournament for all five tournaments in a division, fish two or more tournaments as a Boater in the same division, and are not already advancing to the All-American are eligible to compete in the Wild Card as a Boater. Contestants who pay a Co-angler entry fee prior to the tournament for all five tournaments in a division, fish two or more tournaments as a Co-angler in the same division, and are not already advancing to the All-American are eligible to compete in the Wild Card as a Co-angler. To maintain Wild Card eligibility, entry fees may not be transferred or refunded.

PAYMENT SCHEDULE: Boater entry fees are $220 per one-day tournament and Wild Card, $330 per two-day super tournament, and $350 per two-day regional. Co-angler entry fees are $110 per one-day tournament and Wild Card, $165 per two-day super tournament, and $175 per two-day regional. Entry fees are due upon entry. 

3. POINT STANDINGS • 250 points are awarded to the winner of each tournament, 249 to 2nd, 248 to 3rd, etc., and 375 points are awarded to the winner of each super tournament, 374 to 2nd, 373 to 3rd, etc. Every angler participating in a tournament receives a minimum of 20 points, and every angler participating in a super tournament receives a minimum of 30 points. Anglers must earn weight credit to receive points (above the minimum) for their finish. Any angler who is unable to fish because his or her assigned boater or co-angler withdrew from competition after the pretournament meeting and a replacement is not available will receive 20 points at qualifiers and 30 points at super tournaments. The top 60 boaters and co-anglers from the final point standings in each division (ties resolved by total weight, then total number of fish, then total number of live fish) and the winner of each tournament who fishes two or more events in the division qualify for a 2025 regional and receive priority entry into the 2026 Toyota Series. If a tournament winner is also ranked in the top 60 in the final points standings in a division, the next angler in rank will be invited to the regional. If a qualified angler is unable to attend a regional, the highest-ranked angler in the point standings (who is not yet entered) from any division fishing the regional may be invited. If ranking is equal, invitations will start with the division from which the regional spot was forfeited and will then alternate between divisions. The top three boaters and co-anglers at each regional and the Wild Card qualify for the 2026 All-American. The highest-finishing boater and co-angler from each regional and the Wild Card at the 2026 All-American qualify for the 2026 Toyota Series Championship. The 2026 All-American boater champion qualifies for REDCREST 2027. 

4. PURCHASING OF INFORMATION • The purchasing of, or bartering for, information about locating or catching fish on tournament waters, including but not limited to GPS waypoints (other than through commercially available sources) and the hiring of fishing guide services is not permitted after the entry deadline for each qualifying tournament and super tournament or the start of the off-limits for each regional championship and the All-American: James River Regional: Sep 22, 2025 | Norman Regional: Sep 22, 2025 | Mississippi River Regional: Sep 22, 2025 | Erie Regional: Sep 22, 2025 | Douglas Regional: Sep 29, 2025 | Grand Regional: Sep 29, 2025 | Kentucky-Barkley Regional: Sep 29, 2025 | Logan Martin Regional: Sep 29, 2025 | Murray Regional: Sep 29, 2025 | Seminole Regional: Oct 6, 2025 | Dale Hollow Regional: Oct 13, 2025 | Eufaula Regional: Oct 13, 2025 | Hamilton All-American: May 19, 2025.

Serving as a media boat driver or Official at a Tackle Warehouse Invitational and/or Bass Pro Tour event does not constitute purchasing of information. The sharing of tournament winnings with noncontestants in exchange for information about locating or catching fish on tournament waters is strictly prohibited and will be cause for disqualification from the entire tournament. The purchasing of, or bartering for, fishing locations from another contestant is strictly prohibited and will be cause for both contestants to be disqualified from the entire tournament. 

5. OFF-LIMITS, PRACTICE & COMPETITION • There is no practice period or off-limits period prior to the end of onsite check-in for each qualifying tournament, super tournament and the wild card. Contestants may not enter tournament waters to locate bass or potential fishing waters or sightsee after 6 p.m. local time the day before each tournament’s start date except during tournament hours. Testing equipment on tournament waters after the start of the pretournament meeting is permitted only with prior approval from the tournament director. Once competition is under way, contestants may not solicit and/or receive information about locating or catching fish on tournament waters from anyone except boaters and co-anglers confirmed in the tournament and through publicly available sources (quasi-public websites, blogs and/or social media pages, including but not limited to Facebook, Instagram, Snapchat and Periscope, set up for the specific purpose of sharing information with individuals or a small group of individuals are not publicly available sources). During competition days, contestants may not place brush or other physical fish attractors, including chum of any kind, in tournament waters. During competition days, boaters may not follow a noncontestant’s boat or participate in the placing of markers, brush or other fish attractors by noncontestants or the practice of “hole sitting” by anyone. Anglers eliminated after each round of competition are considered noncontestants. Contestants in the top 20 percent cut after the close of weigh-in on day 1 in super tournaments may not solicit or receive information about locating or catching fish on tournament waters from anyone except other top 20 percent contestants and through publicly available sources. In multiday tournaments, co-anglers who share a boater partner’s fishing locations with another contestant will be disqualified along with the contestant requesting and/or using the information. Off-limits dates for each regional and the All-American are: 

    James River Regional: Sep 22-26, 2025
    Norman Regional: Sep 22-26, 2025       
    Mississippi River Regional: Sep 22-26, 2025      
    Erie Regional: Sep 22-26, 2025
    Douglas Regional: Sep 29-Oct 3, 2025
    Grand Regional: Sep 29-Oct 3, 2025
    Kentucky-Barkley Regional: Sep 29-Oct 3, 2025
    Logan Martin Regional: Sep 29-Oct 3, 2025
    Murray Regional: Sep 29-Oct 3, 2025
    Seminole Regional: Oct 6-10, 2025
    Dale Hollow Regional: Oct 13-17, 2025
    Eufaula Regional: Oct 13-17, 2025
    Hamilton All-American: May 19-25, 2025

During the off-limits period, no contestant may be on tournament waters unless prior approval is received from the tournament director to compete in an MLF tournament on the waters, and no person may be on tournament waters to locate fish or gain fishing information on a contestant’s behalf. After the off-limits period, contestants may practice alone, with an immediate family member (mother, mother-in-law, father, father-in-law, brother, brother-in-law, sister, sister-in-law, son, son-in-law, daughter, daughter-in-law, grandparent, grandchild or spouse), approved domestic partner, another contestant in the tournament or a representative that has been approved by the tournament director prior to entering the water for practice. No practice is permitted at night (beginning at sunset and ending at sunrise) during the practice period. This includes running to and from a fishing location. At no time during practice or on tournament days shall a contestant consult with a noncontestant on or off tournament waters. Flights over tournament waters, including drones, for the express purpose of locating fish or fishing locations are not permitted beginning with the start of the off-limits period, extending through practice and competition days. ALL-AMERICAN - Competition waters are open for practice May 26 through noon local time on May 28, 2025.

6. CHECK-IN & PRETOURNAMENT MEETING • Each contestant must check in at the designated site, send a person who is 16 years of age or older to represent them at the site, check in online at MajorLeagueFishing.com between 8 a.m. and 5 p.m. Central time the Wednesday through Friday before the tournament or call MLF between 8 a.m. and 5 p.m. Central time the Wednesday through Friday before the tournament. Noncontestants can represent one person; contestants can represent themselves and one other person; and the tournament director can represent more than one person. Every contestant or a representative must attend the pretournament meeting to record flights, takeoff time, check-in time, off-limits areas, size and creel limits, and any other relevant tournament rule information. Every contestant or a representative must also attend the boater/co-angler draw immediately following the pretournament meeting to receive the contestant’s boat number, meet the contestant’s boater or co-angler, and record the boater or co-angler’s lodging information, phone number and exact location for the contestant and boater or co-angler to meet prior to takeoff. Check-in hours are 4-6 p.m. local time the day before each tournament. Contestants or their representatives checking in between 6-6:15 p.m. will pay a $25 late fee. Contestants or their representatives who fail to notify the tournament director and are more than 15 minutes late for check-in may forfeit their entry fee and not be entered in the tournament. It is mandatory that all contestants or their representatives attend the pretournament meeting that will be held at 6:30 p.m. local time the day before each tournament. The tournament director can represent more than one person. CONTESTANTS NOT PRESENT OR REPRESENTED AT THE PRETOURNAMENT MEETING WITHOUT PRIOR APPROVAL FROM THE TOURNAMENT DIRECTOR WILL BE FINED $25 ON A FIRST OFFENSE AND MAY FORFEIT THEIR ENTRY FEE AND NOT BE ENTERED IN THE TOURNAMENT FOR SUBSEQUENT OFFENSES. Random checks will be conducted at each meeting. Virtual pretournament meetings may be held in place of in-person check-ins and meetings, in which case details will be provided in tournament confirmation emails.  

7. PAIRINGS • All boaters and co-anglers will be paired by random draw and will receive a text message with their boat number, flight time and boater or co-angler’s name and phone number. All contestants must contact their assigned boater or co-angler following the pretournament meeting. Partners should advise each other of their respective lodging and phone numbers and establish a meeting time and place for the following morning’s takeoff. The tournament director, at his sole discretion, may reassign partners prior to takeoff. If a co-angler drops out onsite, prior to pairings, and a replacement cannot be found, the last two non-priority boaters entered have the option to be paired together. If a boater drops out onsite, prior to pairings, and a replacement cannot be found, the last non-priority co-angler entered may choose to change to boater status if another co-angler is available for pairings or have their entry transferred or refunded with no service charge. 

8. SAFETY • Safe boating must be observed at all times. Each contestant is required to wear a fastened U.S. Coast Guard-approved personal flotation device anytime the combustion engine is running from boat check until weigh-in each day of the tournament. All boats must be equipped with a factory-installed emergency ignition-shutoff device that must be securely attached to the driver’s body with a standard-length, factory tether whenever the combustion engine is running and in gear. Boaters and co-anglers may fish and charge batteries using an onboard charger by letting the combustion engine idle in neutral only if everyone in the boat is wearing a fastened U.S. Coast Guard-approved personal flotation device. All persons must be seated and a driver must be behind the steering wheel in full control of the boat whenever it is on plane or the combustion engine is running and in gear. No pets are permitted in boats during tournament hours. Documented service animals may be permitted with prior approval from the tournament director. At the discretion of the tournament director, tournament days may be shortened, postponed or canceled due to unsafe weather or water conditions. Competitors may leave their boat and seek shelter in bad weather or when danger is imminent. They must, however, stay within sight of each other. Contestants involved in boating accidents and/or safety incidents may be required to complete a BoatUS Foundation boating safety course before participating in another MLF tournament. A free course for each state is available at boatus.org.

9. SPORTSMANSHIP • All contestants are required to follow high standards of sportsmanship, courtesy and conservation and to conduct themselves in a manner that will be a credit to themselves, to MLF, MLF’s sponsors, the sport of fishing and MLF’s efforts to promote the sport. Conduct not complying with these standards includes, but is not limited to, the following:

    Violation of, or failure to comply with, any of the rules for the 2025 Bass Fishing League.
    Consumption and/or possession of alcoholic beverages or any kind of mind-altering substance during check-in or tournament hours extending through the weigh-in procedure.
    Abuse of, or addiction to, mind-altering substances.
    Conviction of a felony within the past 36 months.
    Suspension/disqualification, probation or ban from any tournament or fishing organization.
    Boat operation in an unsafe or unsportsmanlike manner.
    Violation of a posted no-wake area.
    Publicly criticizing or questioning the integrity of MLF or MLF officials, including but not limited to MLF rules, policies and procedures.
    Dissemination of disparaging content or content that one should reasonably know would harm the reputation of MLF, MLF officials or MLF sponsors.
    Any other words, conduct or actions reflecting unfavorably upon efforts to promote safety, sportsmanship, fair competition and compliance with tournament rules, or which fail to comply with the standards set forth in the first sentence of paragraph 9.

In case of any conduct not complying with the standards outlined above, MLF shall have the right to refuse an application to compete, to deny a confirmed application to compete by returning the entry fee, to disqualify a contestant or impose any penalty outlined in paragraph 1.

10. BOAT OPERATION • Boaters will fish from the front deck of the boat only. Co-anglers will fish from the back deck or seating area of the boat only. Boaters will have complete control of boat operation and waters to be fished. For safety concerns in rough water or swift current, in the event of an outboard or trolling motor breakdown or during an emergency, co-anglers may operate the trolling motor or the outboard but may not fish anytime from the front deck. Boaters may not request that the co-angler not fish. Any boater that, in the judgment of the tournament director, operates the boat in a manner that unfairly handicaps his/her co-angler, and any co-angler who unfairly handicaps his/her boater may be disqualified for that day. Contestants may not use mobile communication devices, including but not limited to, cell phones, tablets, marine radios, walkie-talkies, CBs, etc., to communicate with anyone about locating or catching fish on tournament waters during tournament hours. Mobile communication devices may be used during tournament hours to communicate with lockmasters about locking, to communicate with the tournament director or to communicate with MLF editors or producers. Boaters may use smart phones and/or tablets during tournament hours for GPS, mapping, weather, power generation, barge traffic updates, tidal charts, personal fishing notes and related data. At no time during tournament hours may contestants read or discuss social media posts from other contestants. Contestants may only livestream to their personal social media accounts during tournament hours at qualifying events, super tournaments, regionals and the wild card if they are using a streaming camera that does not require them to log into the social media account on a phone, tablet or computer where they can view comments or communications on the account. Contestants who intend to livestream during tournament hours must get prior approval from the tournament director. Contestants are not permitted to livestream or to participate in any livestream during tournament hours at the All-American other than opportunities arranged by MLF. Contestants are expected to compete every day for which they are qualified; failure to do so may result in ineligibility to compete in future MLF tournaments. If a special circumstance arises that inhibits a contestant’s ability to compete, the tournament director may allow the contestant to withdraw from competition and maintain the weight caught to that point. Depending on the need to maintain an equal number of boaters and co-anglers (i.e. day 2 at super tournaments and regionals and day 3 at the All-American), the next highest contestant in the tournament standings may be invited to continue competition. 

11. BOAT & HORSEPOWER REGULATION • All boats must be propeller-driven, a minimum of 16 feet in length and have a rear deck (with a seat if requested). All boats must be equipped with wheel steering; no other steering device will be permitted. No barges or similarly cumbersome craft will be permitted. Each boat must have all required U.S. Coast Guard safety equipment. Boats must contain a properly aerated livewell space to maintain alive a limit catch of bass by both contestants. Maximum horsepower for all outboards used in tournament competition will be 250 horsepower, not to exceed the horsepower capacity set forth on the “Maximum Capacities” placard described below. Each boat must have a clearly legible “Maximum Capacities” (or comparably titled) placard that includes a maximum horsepower rating affixed to the boat by the manufacturer. The horsepower of the outboard engine must not exceed the maximum horsepower capacity specified on this placard or the 250-horsepower maximum set by MLF. By signing the Release of Liability form, contestants agree to submit their boat and/or motor to an inspection by MLF personnel. Falsifying information on entry forms or altering the horsepower numbers on the motor or rating placard will be cause for disqualification from the tournament and may result in ineligibility to compete in future MLF tournaments. Fishing platforms must be factory-installed equipment or commercially available aftermarket equipment that is permanently installed in the boat. No portable platforms may be used in tournament competition. Fuel may be carried only in factory-installed (built-in) fuel tanks. Any additional fuel used during the tournament day must be purchased from a retail facility open to the public and pumped through a hose with a nozzle. The use of generators, other than solar or wind-powered generators, is prohibited in contestant boats during tournament hours on all competition days.

12. FORWARD FACING & 360-DEGREE SONAR • All boats are limited to the use of two forward facing or 360-degree sonar transducers in any combination. Forward facing transducers are defined as any transducer that provides live (real-time) images. Three hundred- and sixty-degree (360) transducers are defined as any transducer producing a beam that rotates 360 degrees. Boats rigged with more than two forward facing or 360-degree sonar transducers in any combination must disconnect the excess transducers and cover the cable plugs using a high-visibility cap provided by MLF through the entirety of the tournament.

13. PERMITTED FISHING METHODS • Fishing is defined as having a lure attached to a line and a rod and reel with the rod in hand. All bass must be caught alive in a conventional sporting manner. All lures must adhere to state regulations. Only artificial lures may be used, with the exception of pork trailers and biodegradable soft baits. All lures are limited to a maximum of five wires with a maximum of five spinners, five lures and three hooks (single or treble) unless state regulations are more restrictive, in which case state regulations prevail. Only ONE fishing rod may be used at a time. Trolling as a method of fishing is strictly prohibited. Trolling is defined as operating the combustion engine to extend a cast or lengthen a retrieve. Co-anglers may not assist boaters and boaters may not assist co-anglers with the use of underwater cameras and viewing systems, including but not limited to floggers, bathyscopes and similar systems. All bass caught while sight-fishing must be hooked inside the mouth and immediately shown to your boater or co-angler for verification. 

14. PERMITTED FISHING LOCATIONS • Contestants may fish anywhere on tournament waters available to the public and accessible by boat except areas posted or otherwise designated as “off-limits,” “no boats,” “keep out,” “restricted,” “no trespassing” or “no fishing” (or similar language or markings intended to restrict public access for fishing or safety) by MLF, commercial property owners and/or local, state or federal officials, or within 50 yards of a contestant’s boat that was first anchored. An anchored boat is a boat held in a stable position by a line attached to a weight or by a Power-Pole or similar shallow water anchor with the trolling motor in the up position. These areas should be considered walled off. Your lure may not enter these waters. Contestants are not permitted to encroach on another contestant, anchor and receive the 50-yard protection outlined above. All fishing must be conducted from the boat. At no time may a contestant leave the boat to land a fish or to make the boat more accessible to fishing waters. Contestants are not permitted to alter the factory flotation of their boat, including adding excessive weight (even temporarily by taking on water), to pass under low hanging obstacles. Any contestant who is found to have fished in an off-limits area will forfeit his or her catch to that point in time of the tournament day and will be eligible to restart and resume competition under the supervision of the tournament director or his designated tournament official after returning to the check-in point. The cutting of trees, bushes and/or logs after the start of the pretournament meeting and/or the removal of official commercial, local, state or federal barricades at any time to make an area more accessible by boat or gain access for fishing is strictly prohibited and may result in disqualification from the tournament. The use of cables, ropes, chains or any type of block and tackle system to maneuver a boat into fishing waters is strictly prohibited and will result in disqualification from the tournament. Contestants must leave and return to the check-in by boat. The boat must remain in the tournament waters during the tournament day. No tournament boat may be loaded on a trailer before the weigh-in except with the permission of the tournament director. In the event of equipment failure or emergency, the tournament director must be notified as soon as it is safe to do so. There are then two permitted methods of returning to the check-in: (1) by both paired anglers remaining in their boat and being towed by water, or (2) with permission from the tournament director, by one or both paired anglers entering the boat of another tournament contestant. Under these two conditions both contestants’ catches may be counted without a penalty (except for late penalties, dead-fish penalties or other penalties pertaining to other tournament rules) provided that the co-angler’s fish are adequately marked so as to provide clear distinction of the boater’s catch and the co-angler’s catch to the tournament director. Contestants who elect to return to the check-in by any other means than cited above will forfeit their day’s catch to that point in time of the tournament day. Abandoning a boat and leaving it adrift without proper tie-off or anchoring after a mechanical failure may result in disqualification of that day’s weight. Any contestant returning to the check-in point will be eligible to restart and resume competition under the supervision of the tournament director or his designated tournament official. It is the sole responsibility of contestants to locate the tournament director to request a restart. Partners must remain together at all times and within sight of each other until the weigh-in. The momentary condition of being out of sight of each other for restroom breaks is permitted. 

15. CHECKPOINTS • There will be only one checkpoint for boat check in the morning and one check-in point in the afternoon. Failure to go through boat check and checkout in the morning or failure to check in at the check-in point will result in disqualification. All fishing must cease upon check-in.

16. LATE PENALTY • Contestants who are not at the check-in area at the appointed time will be penalized 1 pound per minute, deducted from the total weight, including any weight to be counted toward the Big Bass Award. Any contestant more than 15 minutes late will lose credit for that day’s weight.

17. LIVE FISH • Every effort must be made to keep bass alive through the use of a properly aerated livewell. Four ounces will be deducted from the total weight for each dead bass presented for weigh-in.

18. SCORING • Scoring is determined by the pounds and ounces of each contestant’s catch during each qualifying tournament. Only largemouth, spotted, redeye, smallmouth or shoal bass, where permitted, are accepted species. No regurgitated forage or other foreign matter may be placed in a bass. The daily limit will be five bass for boaters and three bass for co-anglers unless conditions dictate a reduced limit for conservation purposes or the state or lake limit is more restrictive, in which case the reduced limits will prevail. After possessing the daily limit, contestants must cull immediately upon their next catch. Boaters and/or co-anglers possessing more than the daily limit must notify the tournament director immediately upon discovery of the infraction and reduce his/her catch to the daily limit by releasing live bass. Anglers possessing more than the daily limit will be penalized 1 pound for each bass over the limit. Bass are considered in possession once placed in the boat and fishing or travel has resumed. The minimum length limit for bass will be 12 inches unless the state or lake limit is more than 12 inches or MLF sets a longer limit for a specific tournament, in which case, the state or lake limit or longer limit set by MLF for the tournament will prevail. Bass presented for weigh-in that fail to measure the prescribed length limit will be penalized at the rate of 1 pound for each short bass presented. Bass presented for weigh-in with weight clips attached will be penalized at the rate of 4 ounces for each clip. Once bass are presented for weigh-in, the catch is final, and no additional bass will be counted. Each contestant’s catch must be presented in an official weigh-in bag and verified by their boater or co-angler. After a contestant’s catch is weighed, it must be turned over to MLF or officials designated by MLF for release unless otherwise instructed by the tournament director. On day 2 in super tournaments, the top 20 percent of boaters and co-anglers based on weight from day 1 compete, and the winners are determined by the heaviest combined weight from days 1 and 2. On day 2 of regionals, the full field competes and winners are determined by the heaviest combined weight from days 1 and 2. On day 3 of the All-American, the top 10 boaters and co-anglers based on the combined weight from days 1 and 2 compete, and winners are determined by the heaviest combined weight from days 1, 2 and 3. 

19. TIES • Ties in one-day tournaments will be resolved by combining and dividing the awards equally among the tied contestants (trophy recipient determined by lottery). Ties on day 1 of two-day super tournaments will be broken first by total number of fish for the tournament, then by total number of live fish for the tournament, then by point standings and then by lottery. The heaviest one-day catch for the tournament will break ties on day 2 of super tournaments. If a tie remains, it will be broken first by total number of fish for the tournament, then by total number of live fish for the tournament, then by day 1 standings. The heaviest one-day catch for the tournament will break ties on day 2 of regionals. If a tie remains, it will be broken first by total number of fish for the tournament, then by total number of live fish for the tournament, then by total points earned in the division from which each contestant qualified and then by highest finish in the super tournament. If a tie remains below third place, contestants will remain tied with awards combined and split equally among the tied contestants. If a tie remains for first, second or third place, it will be broken by a one-hour fish-off. The heaviest one-day catch for the tournament will break ties on day 2 of the All-American. If a tie remains, it will be broken first by number of fish for the tournament, then by total number of live fish for the tournament, then by total points earned in the division from which each contestant qualified (if from the same circuit) and then by highest finish in the super tournament (if from the same circuit). If a tie remains below the cut position, contestants will remain tied with awards combined and split equally among the tied contestants. If a tie remains for the cut position, both anglers will advance to day 3 along with an extra boater or co-angler to even the field. Ties on day 3 will be resolved by day-2 standings. If a tie remains, it will be broken first by the heaviest one-day catch for the tournament, then by the second heaviest one-day catch for the tournament, then by total number of fish for the tournament, then by total number of live fish for the tournament and then by total points earned in the division from which each contestant qualified (if from the same circuit) and then by highest finish in the super tournament (if from the same circuit). If a tie remains below first place, contestants will remain tied with awards combined and split equally among the tied contestants. If a tie remains for first place, it will be broken by a one-hour fish-off.

20. LOGO DISPLAY & MEDIA COVERAGE • Smoking and vaping are not allowed in the weigh-in line during all days of competition. Logo restrictions and additional media requirements apply for the televised All-American and will be provided to qualifying anglers. 

21. TRUTH VERIFICATION TEST • Each contestant agrees to submit, by signature on the Release of Liability form, to a polygraph or voice stress analysis examination and to abide by its conclusion. Failure to pass an examination will result in disqualification from the tournament. Truth verification tests will be used at MLF’s sole discretion, and the determination of the meaning of the results will be made solely by MLF.

22. INSURANCE • Liability insurance with coverage in reasonable amounts is required of all boater contestants in BFL tournaments.

23. CAPTIONS • The captions at the beginning of each paragraph are intended to facilitate convenience in referring to the various rules. The captions are not part of the substance of the paragraph and should not be used in construction of any paragraph or of this overall set of rules.
]

Remember: Your responses should strictly adhere to these rules. Do not speculate or provide information beyond what's contained in the official rules.`;

        const response = await anthropic.messages.create({
            model: "claude-3-haiku-20240307",
            max_tokens: 1024,
            messages: [
                { 
                    role: 'system', 
                    content: rulesContext 
                },
                { 
                    role: 'user', 
                    content: message 
                }
            ]
        });

        context.res = {
            status: 200,
            headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "POST, OPTIONS"
            },
            body: { response: response.content[0].text }
        };
    } catch (error) {
        context.log.error('Error details:', error);
        
        context.res = {
            status: 500,
            headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "POST, OPTIONS"
            },
            body: { 
                error: "Internal server error",
                details: error.message,
                stack: error.stack
            }
        };
    }
};
